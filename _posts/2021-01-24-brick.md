---
layout: post
title:  "ì½”ë“œ í•œì¤„ë¡œ ì•ˆë“œë¡œì´ë“œ SharedPreferenceë¥¼ ì•”í˜¸í™”í•˜ëŠ” ë°©ë²•"
feature-img: "assets/img/post/20210124_thumb.png"
thumbnail: "assets/img/post/20210124_thumb.png"
description: "ì•ˆë“œë¡œì´ë“œ SharedPreferences ë°ì´í„°ë¥¼ ì•”í˜¸í™” í•˜ì—¬ ë³´ì•ˆ ìœ„í˜‘ìœ¼ë¡œë¶€í„° ì§€í‚¤ëŠ” ë°©ë²•ì„ ì†Œê°œí•©ë‹ˆë‹¤."
date:   2021-1-24 12:42:00 +0900
categories: Android, Security
---

> ë‹¹ì‹ ì˜ ì•ˆë“œë¡œì´ë“œ ì•± ë°ì´í„°ëŠ” ì•ˆì „í•œê°€ìš”?

# ğŸ” ë°ì´í„°ë¥¼ ì €ì¥í•  ë• ë°˜ë“œì‹œ ì•”í˜¸í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤.

![security]({{ "/assets/img/post/20210124_01.jpeg" | relative_url}})

[KISAì˜ ê°œì¸ì •ë³´ ì•ˆì „ì„± í™•ë³´ì¡°ì¹˜ ê¸°ì¤€](https://www.kisa.or.kr/public/laws/laws3_View.jsp?cPage=1&mode=view&p_No=259&b_No=259&d_No=101&ST=T&SV=)ì— ë”°ë¥´ë©´ <br/>
ì£¼ë¯¼ë²ˆí˜¸ë‚˜ ë¹„ë°€ë²ˆí˜¸ì™€ ê°™ì€ ê°œì¸ ì •ë³´ë¥¼ ëª¨ë°”ì¼ ë‹¨ë§ì— ì €ì¥í•  ë•ŒëŠ” ë°˜ë“œì‹œ ëª¨ë‘ ì•”í˜¸í™” í•´ì•¼í•©ë‹ˆë‹¤.<br/>
<br/>
ì´ ì™¸ì—ë„ ëª¨ë°”ì¼ ë³´ì•ˆ ì·¨ì•½ì  ê²€ì‚¬ì—ì„œëŠ” ì „í™”ë²ˆí˜¸, ìƒë…„ì›”ì¼, ì´ë¦„ ë“±ì„ í¬í•¨í•œ<br/>
í˜¹ì‹œë¼ë„ ë¯¼ê°í•  ìˆ˜ ìˆëŠ” ê±°ì˜ ëª¨ë“  ì •ë³´ë¥¼ ì•”í˜¸í™” í•˜ëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.<br/>

ë”°ë¼ì„œ ë‹¨ë§ì— ì €ì¥í•˜ëŠ” ë°ì´í„°ëŠ” **ì „ë¶€ ì•”í˜¸í™”**í•˜ëŠ” ê²ƒì´ ì •ì‹ ê±´ê°•ì— ì´ë¡­ìŠµë‹ˆë‹¤.<br/>
ì• ì´ˆë¶€í„° ì•”í˜¸í™” í•˜ëŠ” ìŠµê´€ì„ ë“¤ì´ë©´ ë”ë”ìš± ì¢‹êµ¬ìš” ğŸ‘<br/>
<br/>

# ğŸ‘®â€â™‚ï¸ EncryptedSharedPreferences

[EncryptedSharedPreferences](https://developer.android.com/reference/androidx/security/crypto/EncryptedSharedPreferences)ëŠ”<br/>
êµ¬ê¸€ì—ì„œ ê³µì‹ìœ¼ë¡œ ì œê³µí•˜ëŠ” **ì•”í˜¸í™” ëœ SharedPreferences**ì…ë‹ˆë‹¤. <br/>
<br/>
~~ê°“ë“œë¡œì´ë“œí‚¹íŠ¸íŒ©~~<br/>
<br/>
ë¹„ë¡ ì•ŒíŒŒë²„ì „ì´ë‚˜ êµ¬ê¸€ ê³µì‹ì´ë‹ˆ ì•ˆì‹¬í•˜ê³  ì‚¬ìš©í•  ìˆ˜ ìˆê³ <br/>
ê¸°ì¡´ì˜ SharedPreferencesë¥¼ ìƒì†ë°›ê³  ìˆì–´ì„œ ì²˜ìŒ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ë§Œ ìˆ˜ì •í•˜ë©´<br/>
ì´í›„ì— ë°ì´í„°ë¥¼ ì½ê³  ì“°ëŠ” ê³¼ì •ì—ì„œì˜ ìˆ˜ì •ì€ ì•„ì˜ˆ ì—†ê¸° ë–„ë¬¸ì— ë¬´ì²™ í¸ë¦¬í•©ë‹ˆë‹¤.<br/>
<br/>
ì‹¤ì œë¡œ ì‚¬ìš©í•´ë³´ë©´ í‚¤ê°’ê³¼ ë°ì´í„°ê°€ ëª¨ë‘ ì•”í˜¸í™” ë˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
<br/>
ê·¸ëŸ¼ í•œë²ˆ ì§ì ‘ ì ìš©í•´ë³¼ê¹Œìš”?<br/>

<br/><br/>

## 1. build.gradle(app)ì— ì˜ì¡´ì„± ì¶”ê°€ 

``` groovy
dependencies {
    implementation 'androidx.security:security-crypto:1.0.0-alpha02'
}
```

app ìˆ˜ì¤€ì˜ `build.gradle` ì˜ dependenciesì— ì¶”ê°€í•´ì£¼ë©´ ë©ë‹ˆë‹¤.<br/>

## 2. ì½”ë“œìƒì—ì„œ EncryptedSharedPreferencesë¥¼ í˜¸ì¶œí•˜ê¸°

```kotlin
  val masterKeyAlias = MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC)

  val sharedPreferences = EncryptedSharedPreferences.create(
      "secret_shared_prefs", // íŒŒì¼ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”
      masterKeyAlias,
      context,
      EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
      EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
  )

  val editor: SharedPreferences.Editor = sharedPreferences.edit()
```

`EncryptedSharedPreferences`ê°€ ì´ë¯¸ SharedPreferences ì´ë¯€ë¡œ ì´í›„ì—ëŠ” <br/>
ê¸°ì¡´ì— ì‰ì–´ë“œí”„ë¦¬í¼ëŸ°ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë˜ ê³³ì—ì„œ ë°ì´í„°ë¥¼ ì½ê³  ì“°ëŠ” ì½”ë“œëŠ” ë™ì¼í•˜ë¯€ë¡œ<br/>
ë³„ë„ì˜ ì½”ë“œ ìˆ˜ì • ì—†ì´ ê¸°ì¡´ì— ì‚¬ìš©í•˜ì‹œë˜ ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.<br/><br/>
<br/>



# ğŸ¤” ê·¸ëŸ°ë° ë§ì…ë‹ˆë‹¤

ìƒˆë¡œ ë§Œë“œëŠ” ì•±ì—ì„œ `EncryptedSharedPreferences`ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ <br/>
ì´í›„ ì•ìœ¼ë¡œ ì €ì¥ë˜ëŠ” ëª¨ë“  ë°ì´í„°ê°€ ì•”í˜¸í™” ë˜ê² ì§€ë§Œ<br/>
ì•ˆíƒ€ê¹ê²Œë„ ë³´í†µ ì´ ê¸€ì„ ì½ê³  ê³„ì‹ ë¶„ì´ë¼ë©´ <br/>
ì´ë¯¸ ë°°í¬ë˜ì–´ ì‚¬ìš©ì ë‹¨ë§ì— ì €ì¥ëœ ë°ì´í„°ì˜ ì•”í˜¸í™”ê°€ í•„ìš”í•˜ì‹  ë¶„ë“¤ì´ ë§ìœ¼ì‹¤ ê²ƒ ê°™ìŠµë‹ˆë‹¤.<br/>
<br/>
ì´ë¯¸ ë°°í¬ëœ ì•±ì´ë¼ì„œ ì‚¬ìš©ìê°€ ë°ì´í„°ë¥¼ í‰ë¬¸ìœ¼ë¡œ ì €ì¥í•˜ê³  ìˆë‹¤ë©´<br/>
ì´ **ì €ì¥ëœ ë°ì´í„°ë¥¼ ì „ë¶€ ì•”í˜¸í™” í•˜ëŠ” ì´ê´€ì‘ì—…**ì´ ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤.<br/>
<br/><br/>
ì—¬ëŸ¬ê°€ì§€ ë°©ë²•ì´ ìˆì„ ìˆ˜ ìˆê² ì§€ë§Œ ì´ ê¸€ì—ì„œëŠ” ê°€ì¥ ì‰½ê²Œ 

1. ê¸°ì¡´ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³ 
2. ìƒˆë¡œìš´ íŒŒì¼ì— ì•”í˜¸í™” í•´ì„œ ë³µì‚¬ 

í•˜ëŠ” ë°©ë²•ì„ ì†Œê°œë“œë¦¬ê² ìŠµë‹ˆë‹¤.<br/>
<br/>
<br/>

## ğŸ“¨ ê¸°ì¡´ ë°ì´í„° ì´ê´€í•˜ê¸°

ê¸°ì¡´ì— ì´ë¯¸ ì‚¬ìš©í•˜ê³  ìˆëŠ” ë°ì´í„°ë¥¼ ì•”í˜¸í™” í•˜ëŠ” ë¬¸ì œëŠ” ë˜ ë³„ê°œì˜ ë¬¸ì œì…ë‹ˆë‹¤<br/>
<br/>
ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì€ ê¸°ì¡´ì˜ ë°ì´í„°ë¥¼ ì „ë¶€ ì•”í˜¸í™”í•˜ì—¬ ë³µì‚¬í•˜ê³  ê¸°ì¡´ì˜ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì—¬ <br/>
ë¬´ì¡°ê±´ ì•”í˜¸í™” ëœ ë°ì´í„°ë§Œ ì ‘ê·¼í•˜ë„ë¡ í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.<br/>
<br/>

> âš ï¸ ë³µì‚¬í•˜ê³  ê¸°ì¡´ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ëŠ” ë°©ì‹ì´ë¯€ë¡œ ì•”í˜¸í™” í•  íŒŒì¼ì´ë¦„ê³¼ ê¸°ì¡´ íŒŒì¼ì´ë¦„ì€ ë‹¬ë¼ì•¼ í•©ë‹ˆë‹¤.


```kotlin
// ì•”í˜¸í™” ë˜ì§€ ì•Šì€ ë ˆê°€ì‹œ ë°ì´í„°
val legacy = SharedPreferences by mContext.getSharedPreferences(mFile, Context.MODE_PRIVATE)
val entries = legacy.all.entries

// ëª¨ë“  ë°ì´í„°ë¥¼ ë³µì‚¬í•œë‹¤.
// editorëŠ” EncryptedSharedPreferencesì˜ editor 
entries.forEach {
    when (it.value) {
        is String -> editor.putString(it.key, it.value as String).apply()
        is Long -> editor.putLong(it.key, it.value as Long).apply()
        is Int -> editor.putInt(it.key, it.value as Int).apply()
        is Float -> editor.putFloat(it.key, it.value as Float).apply()
        is Boolean -> editor.putBoolean(it.key, it.value as Boolean).apply()
        is Set<*> -> editor.putStringSet(it.key, it.value as Set<String>).apply()
    }
}
```

ë³µì‚¬ë¥¼ ë‹¤í–ˆë‹¤ë©´ ê¸°ì¡´ì˜ í‰ë¬¸ ë°ì´í„°ë¥¼ ì „ë¶€ ì§€ì›Œë²„ë¦½ì‹œë‹¤.<br/>

```kotlin
legacy.edit().clear().apply()
```

<br/><br/><br/>

## ê·¸ëŸ°ë° ì ê¹, ìµœì†Œì§€ì›ì´ api23 ì´ë¼êµ¬ìš”? ğŸ˜± ğŸ˜± ğŸ˜± 

![no_please_no]({{ "/assets/img/post/20210124_no.gif" | relative_url}})

ë„¤ ê·¸ë ‡ìŠµë‹ˆë‹¤. <br/>
ë§ˆì‹œë©œë¡œì´í•˜ëŠ” ì´ ë°©ë²•ìœ¼ë¡œëŠ” í•  ìˆ˜ ê°€ ì—†ê¸° ë•Œë¬¸ì—<br/>
ê²°êµ­ ìƒˆë¡œìš´ ì•”í˜¸í™” ëª¨ë“ˆì„ ë§Œë“¤ì–´ì„œ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.ğŸ˜±<br/><br/>

ë¬¸ì œëŠ” ì•„ì§ê¹Œì§€ë„ ë§ì€ ì•±ë“¤ì˜ ìµœì†Œ ì§€ì› apiê°€ 19, 21 ì •ë„ì— ë¨¸ë¬¼ëŸ¬ìˆê¸° ë•Œë¬¸ì—<br/>
ê¸°ê» EncryptedSharedPreferencesê°€ ìˆì–´ë„ í™œìš©í•˜ê¸°ê°€ ì–´ë µë‹¤ëŠ” ì ì´ ê°€ì¥ í° ë¬¸ì œì…ë‹ˆë‹¤.<br/><br/>



## ğŸ¤·â€â™‚ï¸ ê·¸ëŸ¼ ì´ì œ ì–´ë–¡í•˜ì£ ?

ì•„ì§ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤. <br/>

[BrickSharedPreferences](https://github.com/HaenaraShin/BrickSharedPreference)ë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”!<br/><br/>


# BrickSharedPreferencesê°€ ë­”ë°?

![BrickSharedPreferences]({{ "/assets/img/post/20210124_brick.png" | relative_url}})

<br/>

#### Api ë ˆë²¨ ìƒê´€ ì—†ì´ SharedPreferencesë¥¼ ì•”í˜¸í™”í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì…ë‹ˆë‹¤.

minSdk 14ë¡œ ë‚®ì€ ë ˆë²¨ê¹Œì§€ ì§€ì›í•˜ë©°<br/>
23 ì´ìƒì´ë¼ë©´ ì œíŠ¸íŒ©ì˜ EncryptedSharedPreferencesë¥¼ ì‚¬ìš©í•˜ê³ <br/>
23 ë¯¸ë§Œì´ë¼ë©´ ì»¤ìŠ¤í…€ ì•”í˜¸í™” SharedPreferencesë¥¼ ì´ìš©í•˜ëŠ” ë³´ì•ˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì…ë‹ˆë‹¤.<br/>

ë˜í•œ ì¶”ê°€ë¡œ ìœ„ì—ì„œ ì„¤ëª…í•œ 'ê¸°ì¡´ ë°ì´í„° ì´ê´€'ì„ **ë‹¨ í•œì¤„ë¡œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**<br/><br/>

## 1. build.gradle(app)ì— ì˜ì¡´ì„± ì¶”ê°€ 

```kotlin
dependencies {
    implementation 'dev.haenara:bricksharedpref:1.0.2'
    implementation 'androidx.security:security-crypto:1.0.0-alpha02'
}
```


## 2. ì½”ë“œìƒì—ì„œ BrickSharedPreferencesë¥¼ í˜¸ì¶œí•˜ê¸°


```kotlin 
// ê¸°ì¡´ SharedPreferencesë¥¼ ê°€ì ¸ì˜¤ëŠ” ë°©ë²•ì— "Brick"ë§Œ ì•ì— ë¶™ì´ë©´ ëœë‹¤. 
val mSharedPreferences = getBrickSharedPreferences(fileName, Context.MODE_PRIVATE)
```

ê¸°ì¡´ì— ì‰ì–´ë“œí”„ë¦¬í¼ëŸ°ìŠ¤ í˜¸ì¶œ ì‹œì— ì½”í‹€ë¦°ì—ì„œ ì‚¬ìš©í•˜ë˜ `getSharedPreferences`ë¥¼<br/> 
`getBrickSharedPreferences`ë¡œ ê³ ì¹œ ê²ƒì´ ì „ë¶€ì…ë‹ˆë‹¤.<br/>

BrickSharedPreferencesë„ ê¸°ì¡´ì— ì‰ì–´ë“œí”„ë¦¬í¼ëŸ°ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë˜ ê³³ì—ì„œ ë°ì´í„°ë¥¼ ì½ê³  ì“°ëŠ” ì½”ë“œëŠ” ë™ì¼í•˜ë¯€ë¡œ<br/>
ë³„ë„ì˜ ì½”ë“œ ìˆ˜ì • ì—†ì´ ê¸°ì¡´ì— ì‚¬ìš©í•˜ì‹œë˜ ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.<br/><br/>
<br/>

## 3. ê¸°ì¡´ ë°ì´í„° ì´ê´€í•˜ê¸°

```kotlin
mSharedPreferences.migrateEncryptedSharedPreferences()
```

ìš”ê±° í•œì¤„ì´ë©´ í•´ê²°ë©ë‹ˆë‹¤.

![sample_run]({{ "/assets/img/post/20210124_ma1.jpg" | relative_url}})
<br/>
![sample_run]({{ "/assets/img/post/20210124_ma2.jpg" | relative_url}})
<br/>
![sample_run]({{ "/assets/img/post/20210124_ma3.jpeg" | relative_url}})
<br/>
![sample_run]({{ "/assets/img/post/20210124_ma4.jpeg" | relative_url}})

<br/>

ë‹¨, ë§Œì•½ SharedPreferencesë¥¼ ì‚¬ìš©ì¤‘ì¸ íŒŒì¼ì´ ì—¬ëŸ¬ê°œë¼ë©´ ê°ê° í˜¸ì¶œí•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.<br/>

ì•± ì‹¤í–‰ ì‹œ ë”± í•œë²ˆë§Œ í˜¸ì¶œí•´ì£¼ë©´ ë˜ê¸° ë•Œë¬¸ì— <br/>
Application classì˜ onCreate() ì—ì„œ í˜¸ì¶œí•´ì£¼ëŠ” ê²ƒì´ ê°€ì¥ í¸ë¦¬í•©ë‹ˆë‹¤.<br/>

<br/><br/>

## 4. ì‹¤í–‰ ì˜ˆì œ

![sample_run]({{ "/assets/img/post/20210124_sample_run.gif" | relative_url}})

[BrickSharedPreferences ë ˆí¬ì§€í† ë¦¬](https://github.com/HaenaraShin/BrickSharedPreference)ì— ìì„¸í•˜ê²Œ ì„¤ëª…ë˜ì–´ ìˆìœ¼ë‹ˆ <br/>

í•„ìš”í•˜ì‹œë‹¤ë©´ ìƒ˜í”Œ ì•±ê³¼ ì½”ë“œë¥¼ ì°¸ê³ í•´ë³´ì‹œëŠ” ê²ƒë„ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤ğŸ‘<br/>

<br/><br/><br/>

# ğŸš€ ê²°ë¡ 

ëª¨ë°”ì¼ ë‹¨ë§ì— ì €ì¥í•˜ëŠ” ëª¨ë“  ë°ì´í„°ëŠ” ì•”í˜¸í™” í•´ì•¼í•©ë‹ˆë‹¤.<br/>
BrickSharedPreferencesë¥¼ ì´ìš©í•´ì„œ ê°„í¸í•˜ê²Œ ë°ì´í„°ë¥¼ ì•”í˜¸í™” í•´ë³´ì„¸ìš”.<br/>
ë§Œì•½ ìœ ìš©í•˜ê²Œ ì“°ì…¨ë‹¤ë©´ ê¹ƒí—™ì—ì„œ **â­ï¸ìŠ¤íƒ€**ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš” ğŸ‘<br/>

# ë ˆí¼ëŸ°ìŠ¤

- [EncryptedSharedPreferences - êµ¬ê¸€ Android Developer](https://developer.android.com/reference/kotlin/androidx/security/crypto/EncryptedSharedPreferences)
- [BrickSharedPreferences](https://github.com/HaenaraShin/BrickSharedPreference)

<br/><br/>